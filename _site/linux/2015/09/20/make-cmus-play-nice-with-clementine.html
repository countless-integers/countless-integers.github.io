<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Make cmus play nice with clementine</title>
  <meta name="description" content="TL;DRI’ve written a tiny script to allow me to bind media keys to the currently used audio player.">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/linux/2015/09/20/make-cmus-play-nice-with-clementine.html">
  <link rel="alternate" type="application/rss+xml" title="countless-integers blog" href="http://localhost:4000/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">countless-integers blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Make cmus play nice with clementine</h1>
    <p class="post-meta">Sep 20, 2015</p>
  </header>

  <article class="post-content">
    <h2 id="tldr">TL;DR</h2>
<p>I’ve written a tiny script to allow me to bind media keys to the currently used audio player.</p>

<h2 id="backstory">Backstory</h2>
<div class="collapsable">
<p>
Some people collect stamps, others cook exquisite cuisnes and other like to get drunk and cause trouble in public
transporatation. I like to fiddle with my Arch Linux machine at home. It's good to have a hobby, right?
</p>
<p>
My setup likes to quit on me after package updates. Being a rolling release, Arch does that every now and then. Latetly
my KDE apps stopped rendering correctly. It made interacting with most of them impossible. Clementine in particular
caused me much grief, since you can't do much with it without its gui controlls. A major annoyance, one in a long line,
but I'm not really complaining because apps dying make you learn something new. Finding a cli media player being
a case in point here.
</p>
<p>
I have looked at cli players before, but usually dropped them because I couldn't make them work with global media
control keys -- an important feature for me. This time round I decided to make it work whatever it takes. 
</p>
</div>

<h3 id="the-player">The player</h3>
<p>I chose <a href="https://github.com/cmus/cmus">cmus</a> as my clementine alternative. I used it before and I liked the interface.
Some of the keybinding resemble those of vim (well homerow <kbd>hjkl</kbd> at least). It’s pretty quick to setup and
use. Library scanning is also quite speedy. Advantages all around. There’s plenty of good posts and documentation for
cmus, so I won’t delve into it’s use and virtues here. I’ll post some links below though<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup></p>

<h2 id="the-bind">The bind</h2>
<p>So cmus worked great, but it doesn’t respond to media keys. It does have an utility to allow for external control of
it’s functions aptly named <code class="highlighter-rouge">cmus-remote</code>. With it you can toggle play/pause, switch to next track and so on. I don’t
care much for volume control, because I prefer to leave that to the system. So all I have to do is to hook up
<code class="highlighter-rouge">cmus-remote</code> to global keybinding.</p>

<p>There are many ways to achieve that, but I used the simple, gui way. KDE has a setting panel for configuring keybindings
and it looks like this:</p>

<figure class="image">
  <img src="/img/cmus.art.2.png" alt="setting keybinding on the media-play key" />
  <figcaption>setting keybinding on the media-play key</figcaption>
</figure>

<figure class="image">
  <img src="/img/cmus.art.3.png" alt="setting custom binding to cmus-remote" />
  <figcaption>setting custom binding to cmus-remote</figcaption>
</figure>

<p>There is a little hickup after setting those keybindings – now other players (e.g., clementine) aren’t able to use those media key
bidings.</p>

<p>Bash scripting to the rescue:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="k">if </span>pgrep <span class="s2">"clementine$"</span>; <span class="k">then 
    if</span> <span class="o">[</span> -f /Applications/clementine.app/Contents/MacOS/clementine <span class="o">]</span>; <span class="k">then</span>
        /Applications/clementine.app/Contents/MacOS/clementine -t
    <span class="k">fi
    </span>clementine -t 2&gt;/dev/null
<span class="k">elif </span>pgrep <span class="s2">"cmus$"</span>; <span class="k">then
    </span>cmus-remote -u 2&gt;/dev/null
<span class="k">fi</span>
</code></pre>
</div>

<p>Now I made that executable and put it in <code class="highlighter-rouge">~/bin/mediaToggle.sh</code> (which btw. is already in my <code class="highlighter-rouge">$PATH</code> lookup).</p>

<figure class="image">
  <img src="/img/cmus.art.1.png" alt="setting custom binding to newly written script" />
  <figcaption>setting custom binding to newly written script</figcaption>
</figure>

<p>Now, when clementine would be running <kbd>play</kbd> would interact with it. But when it would’t run it’ll try to
toggle play on cmus instance (it’d have to be running, though). Great.</p>

<h2 id="last-words">Last words</h2>
<div class="collapsable">
<p>
So here I am: I wanted to play some music to relax after work, but ended up switching media player, writing some
hack-script to make it work the way I wanted it to and in the end writing all that up in this blog post. All because of
some unexpected glitch in qt app (?) rendering.
</p>
<p>
I won't be replacing clementine with cmus (because portability, companion app with remote and media import and general
awesomnes), but it's nice to have a reliable alternative like that. 
</p>
</div>

<script>
(function () {
    var collapsables = document.querySelectorAll('.collapsable');
    if (!collapsables.length || !document.body.addEventListener || !document.body.classList) return;
    Array.prototype.forEach.call(collapsables, function (el) {
        var trigger = el.previousElementSibling;
        trigger.classList.add('collapsableTrigger');
        trigger.addEventListener('click', function (event) {
            trigger.classList.toggle('collapsableTrigger');
        }, false);
    });
})();
</script>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>some reference material for cmus:&nbsp;<a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <h2 class="footer-heading">countless-integers blog</h2>
          <li><a href="mailto:"></a></li>
          <li><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/countless-integers">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">countless-integers</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">My random thoughts and weird stories inspired by dailly coding.  This blog runs on the awesome Jekyl.
</p>
      </div>
    </div>

  </div>

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', "UA-67251979-1", 'auto');
    ga('send', 'pageview');
  </script>
  
</footer>


  </body>

</html>
