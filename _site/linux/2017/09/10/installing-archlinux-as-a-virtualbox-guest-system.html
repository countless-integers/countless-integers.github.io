<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Installing ArchLinux as a VirtualBox guest system</title>
  <meta name="description" content="Installing ArchLinux on a VirtualBox Machine">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/linux/2017/09/10/installing-archlinux-as-a-virtualbox-guest-system.html">
  <link rel="alternate" type="application/rss+xml" title="countless-integers blog" href="http://localhost:4000/feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">countless-integers blog</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Installing ArchLinux as a VirtualBox guest system</h1>
    <p class="post-meta">Sep 10, 2017</p>
  </header>

  <article class="post-content">
    <h1 id="installing-archlinux-on-a-virtualbox-machine">Installing ArchLinux on a VirtualBox Machine</h1>

<h2 id="preparation">Preparation</h2>
<p>First things first – obtain the Arch Linux installation media in form of an ISO volume from https://www.archlinux.org/download/.</p>

<p>Assuming you have VirtualBox already installed, create a new VM. ArchLinux is one of the recognized machine types in the VM creator form, so use it. Allocate some of your host machine resources to the machine, adjust accordingly to your rig’s capabilities.</p>

<p>One thing I’m going to do, that might not be strictly necessary is to enable EFI under “System” settings (this is related to bootloader configuration described later in this article):</p>

<figure class="image">
  <img src="/img/enable-eif-in-vbox.png" alt="Enable EFI in VirtualBox settings panel" />
  <figcaption>Enable EFI in VirtualBox settings panel</figcaption>
</figure>

<p>One last this to remember – if you enable input capturing inside VirtualBox window, remember you host key. On Windows it’ll be the right “Ctrl” key, on MacOs the right “Cmd”. Another useful thing: “Ctrl+Home” will open Vbox machine pop-up allowing you to do things like reboot and ejecting virtual devices (e.g. ArchLinux installation ISO image).</p>

<p>Now it’s time to follow <a href="https://wiki.archlinux.org/index.php/Installation_guide">ArchLinux installation guide</a> to the letter.</p>

<h2 id="partitioning">Partitioning</h2>
<p>I’ve went with a dynamically allocated 8gb storage volume for my virtual hard drive. I’ve also decided to go with GPT/EFI partitions.</p>

<p>According to most of the guides I could find, the suggested layout would look as follows:</p>

<ol>
  <li><code class="highlighter-rouge">/boot</code> partition, 512 MiB in size at the begging</li>
  <li>swap partition, min. 512 MiB in size</li>
  <li><code class="highlighter-rouge">/</code> partition using the remainder of the drive</li>
</ol>

<p>To make this happen we can use a multitude of tools: <code class="highlighter-rouge">gdisk</code>, <code class="highlighter-rouge">fdisk</code>, <code class="highlighter-rouge">cfdisk</code>. Here is an example using <code class="highlighter-rouge">gdisk</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code># gdisk /dev/sda
</code></pre>
</div>

<figure class="image">
  <img src="/img/gdisk-partition-scan.png" alt="Partition set-up in gdisk" />
  <figcaption>Partition set-up in gdisk</figcaption>
</figure>

<p>Running that will start a partition scan to assess the current state of drive’s partitioning.</p>

<figure class="image">
  <img src="/img/gpt-partitioning.png" alt="Partition set-up in gdisk" />
  <figcaption>Partition set-up in gdisk</figcaption>
</figure>

<p>If you went through some trial and error when creating partitions, <code class="highlighter-rouge">gdisk</code> will kindly suggest to reboot (something <code class="highlighter-rouge">cfdisk</code> failed to do for me). Do so if necessary. In the end you should end up with:</p>

<figure class="image">
  <img src="/img/ls-of-devs.png" alt="List of storage devices" />
  <figcaption>List of storage devices</figcaption>
</figure>

<h2 id="formatting">Formatting</h2>
<p>Assuming the layout created above:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mkfs.fat -F32 /dev/sda1
mkswap /dev/sda2
mkfs.ext4 /dev/sda3
</code></pre>
</div>
<h2 id="mount-the-partitions">Mount the partitions</h2>
<div class="highlighter-rouge"><pre class="highlight"><code># mount /dev/sda3 /mnt
# mkdir /mnt/boot
# mount /dev/sda1 /mnt/boot
# swapon /dev/sda2 # this should not be necessary because of genfstab
</code></pre>
</div>

<h2 id="boostrap-root-partition">Boostrap root partition</h2>
<p>Time to install the basics:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># pacstrap /mnt base
</code></pre>
</div>

<p>This will install the basic set of packages required to log in to the system.
To inform the newly bootstrap system of all the partitions we’re going to use and have them mounted on boot:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</code></pre>
</div>

<p>This will generate a <code class="highlighter-rouge">fstab</code> file, referencing drives by their UUID (as an alternative to referencing them by their labels).</p>

<h2 id="logging-in">Logging-in</h2>
<p>Now we can finally log in to the system with:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># arch-chroot /mnt
</code></pre>
</div>

<p>Well, technically changing root is not the same as logging in, more like, well changing root directory to a specified folder…</p>

<h2 id="basic-configuration">Basic configuration</h2>

<p>Time and localization options:</p>

<p>Uncomment <code class="highlighter-rouge">en_US.UTF-8 UTF-8</code> and others needed in <code class="highlighter-rouge">/etc/locale.gen</code> and run:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># locale-gen
</code></pre>
</div>

<p>Then:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># echo "LANG=en_US.UTF-8" &gt; /etc/locale.conf
</code></pre>
</div>

<p>Time:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># ln -sf /usr/share/zoneinfo/Europe/&lt;City&gt; /etc/localtime
# timedatectl set-ntp true
</code></pre>
</div>

<p>Set hostname:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># echo vbox &gt; /etc/hostname
</code></pre>
</div>

<p>I’ve used vbox, but you can use whatever. But whatever you use, remember it for this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># echo -e "\n127.0.1.1\tvbox.localdomain\tvbox" &gt;&gt; /etc/hosts
</code></pre>
</div>

<p><code class="highlighter-rouge">-e</code> flag will make <code class="highlighter-rouge">echo</code> interpret escape character like <code class="highlighter-rouge">\t</code> and help to keep <code class="highlighter-rouge">/etc/hostnames</code> file consistently formatted.</p>

<p>Networking:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># systemctl enable dhcpcd
</code></pre>
</div>

<p>for a wired connection. It’s possible to set-up wireless, but I’ll not cover this, because for a VBox install it does not seem practical.</p>

<p>XOrg and ALSA for audio-video capabilities:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># pacman -S xf86-video-intel xf86-video-fbdev xorg-server xorg-xinit xorg-twm xterm alsa-utils pulseaudio pulseaudio-alsa
</code></pre>
</div>

<p>VirtualBox guest additions:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># pacman -S virtualbox-guest-utils virtualbox-guest-modules-arch
</code></pre>
</div>

<p>This will allows us to change screen resolution and a couple of other useful things. <a href="https://wiki.archlinux.org/index.php/VirtualBox#Installation_steps_for_Arch_Linux_guests">More about guest additions and what can they do.</a></p>

<p>A window manager (I chose XFCE4 as a compromise between nice to use and light on resources):</p>

<div class="highlighter-rouge"><pre class="highlight"><code># pacman -S xfce4
</code></pre>
</div>

<p>Various stuff you might need:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># pacman -S vim zsh rsync firefox atom terminator python3 nodejs git
</code></pre>
</div>

<p>Set up password for the root user (interactive command):</p>

<div class="highlighter-rouge"><pre class="highlight"><code># passwd
</code></pre>
</div>

<p>Add a non-root user:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># useradd -m -g users -G adm,lp,wheel,power,audio,video -s /bin/zsh me
# passwd me
# EDITOR=vim visudo  # uncomment %wheel
</code></pre>
</div>

<p>where “me” is you (or whatever login you want to use). <code class="highlighter-rouge">wheel</code> is a sudoers group, why it’s called like that, I do not know.</p>

<p>That should be enough to get started. So now:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>exit
umount /mnt -R # -R because of /boot partition mounted in /mnt/boot
reboot
</code></pre>
</div>

<h2 id="installing-the-bootloader">Installing the bootloader</h2>
<p>Arch guide lists this step near the end, but I decided to make it the first one, since this has been the most troublesome and confusing. Back in the day you would just install to MBR and things would be dandy:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># pacman -S grub
# grub-install /dev/sda
</code></pre>
</div>

<p>However this new madness of (U)EFI firmware came about and now it’s more like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># pacman -S grub efibootmgr
# grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub
</code></pre>
</div>

<p>Which should output something like this at the end:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>Installation finished. No errors reported.
</code></pre>
</div>

<p>Then we can generate GRUB’s config file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>
</div>

<p>If that goes well, we’re set.</p>

<h2 id="first-actual-log-in">First actual log-in</h2>
<p>I’d recommend to login as the non-root users we created to test if that works correctly. If yes I’d also suggest to run:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># sudo pacman -Syu
</code></pre>
</div>

<p>to test that <code class="highlighter-rouge">sudo</code> was configured properly and update the system at the same time.</p>

<p>Afterwards, we can try the window manager:</p>

<div class="highlighter-rouge"><pre class="highlight"><code># startxfce4
</code></pre>
</div>

<h2 id="prosper">Prosper</h2>
<p>All is now set, ready to use and further customizations. Enjoy!</p>

<figure class="image">
  <img src="/img/xfce-4.png" alt="End result -- XFCE 4 running at ArchLinux guest VirtualBox installation" />
  <figcaption>End result -- XFCE 4 running at ArchLinux guest VirtualBox installation</figcaption>
</figure>

<h2 id="extra-references">Extra references</h2>

<ul>
  <li><a href="https://unix.stackexchange.com/questions/288865/file-system-boot-is-not-a-fat-efi-system-partition-esp-file-system?answertab=active#tab-top">StackXxchange :: Preparing /boot partition for EFI</a></li>
  <li><a href="https://raw.githubusercontent.com/midfingr/youtube_notes/master/arch_way">Github :: A bit outdated, but still useful installation cheatsheet</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/Installation_guide">Arch Wiki :: Installation Guide</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/GRUB/EFI_examples">Arch Wiki :: EFI examples for GRUB configuration</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/GRUB#Check_if_you_have_GPT_and_an_ESPo">Arch Wiki :: Checking if GPT can be used</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/VirtualBox#Installation_steps_for_Arch_Linux_guests">Arch Wiki :: Installation steps for Arch Linux as VirtualBox guest machine</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/Xorg#Installation">Arch Wiki :: XOrg installation</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/partitioning#GUID_Partition_Table">Arch Wiki :: GUID and partition tables</a></li>
  <li><a href="https://wiki.archlinux.org/index.php/Systemd-timesyncd">Arch Wiki :: Timesync Systemd service</a></li>
</ul>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <h2 class="footer-heading">countless-integers blog</h2>
          <li><a href="mailto:"></a></li>
          <li><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/countless-integers">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">countless-integers</span>
            </a>
          </li>
          

          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">My random thoughts and weird stories inspired by dailly coding.  This blog runs on the awesome Jekyl.
</p>
      </div>
    </div>

  </div>

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', "UA-67251979-1", 'auto');
    ga('send', 'pageview');
  </script>
  
</footer>


  </body>

</html>
